const fs = require('fs-extra');
const path = require('path');

const commentsDatabase = path.join(__dirname, '..', 'data', 'fb_comments.json');

module.exports = {
    config: {
        name: "fcomment",
        version: "1.0",
        author: "Marina",
        countDown: 5,
        role: 1,
        description: {
            en: "Generate Facebook post comments for different types of posts"
        },
        category: "comments",
        guide: {
            en: "{p}fcomment [type] [count]\n{p}fcomment add [type] [comment]\n{p}fcomment types"
        }
    },

    onStart: async function ({ api, event, args }) {
        await this.ensureDataDir();
        
        const action = args[0];
        
        if (!action) {
            const helpMessage = `ğŸ’¬ **FACEBOOK POST COMMENT GENERATOR** ğŸ’¬

ğŸ‘‘ **Powered by Marina - Comment Expert**

ğŸ¯ **Comment Types:**
â€¢ islamic - Islamic posts & greetings
â€¢ funny - Funny & humorous posts
â€¢ love - Love & relationship posts
â€¢ sad - Emotional & sad posts
â€¢ angry - Controversial posts
â€¢ wow - Amazing content
â€¢ support - Supportive comments
â€¢ question - Question posts
â€¢ news - News posts
â€¢ photo - Photo posts
â€¢ video - Video posts
â€¢ status - Status updates
â€¢ marina - Marina special comments

ğŸ’¡ **Usage Examples:**
{p}fcomment islamic 10
{p}fcomment funny 5
{p}fcomment love 3
{p}fcomment add islamic "Masha Allah beautiful post!"
{p}fcomment types

ğŸŒŸ **Perfect for engaging with any Facebook post!**`;

            await api.sendMessage(helpMessage, event.threadID);
            return;
        }

        if (action === 'add') {
            await this.handleAddComment(api, event, args.slice(1));
        } else if (action === 'types') {
            await this.showCommentTypes(api, event);
        } else {
            await this.generateFBComments(api, event, args);
        }
    },

    generateFBComments: async function (api, event, args) {
        const type = args[0] || 'islamic';
        const count = parseInt(args[1]) || 5;
        
        if (count > 20) {
            return api.sendMessage("âŒ Maximum 20 comments at a time for better performance.", event.threadID);
        }

        const comments = await this.getFBComments(type, count);
        if (comments.length === 0) {
            return api.sendMessage(`âŒ No comments found for type: ${type}`, event.threadID);
        }

        let response = `ğŸ’¬ **FACEBOOK ${type.toUpperCase()} COMMENTS** ğŸ’¬\n\n`;
        comments.forEach((comment, index) => {
            response += `${index + 1}. ${comment}\n\n`;
        });

        response += `\nğŸ‘‘ Generated by Marina's Comment System\nğŸ“Š ${comments.length} comments ready for Facebook!`;

        await api.sendMessage(response, event.threadID);
    },

    handleAddComment: async function (api, event, args) {
        const type = args[0];
        const text = args.slice(1).join(' ');
        
        if (!type || !text) {
            return api.sendMessage("âŒ Use: fcomment add [type] [comment text]", event.threadID);
        }

        try {
            const commentsData = await fs.readJson(commentsDatabase);
            if (!commentsData[type]) {
                commentsData[type] = [];
            }
            
            commentsData[type].push(text);
            await fs.writeJson(commentsDatabase, commentsData);
            
            await api.sendMessage(`âœ… Added new ${type} comment to Facebook database! ğŸ’¾`, event.threadID);
        } catch (error) {
            await api.sendMessage("âŒ Error adding comment to database.", event.threadID);
        }
    },

    showCommentTypes: async function (api, event) {
        const typesInfo = `ğŸ“‹ **FACEBOOK COMMENT TYPES** ğŸ“‹

ğŸ•Œ ISLAMIC - For Islamic posts, Quran verses, mosque photos
ğŸ˜‚ FUNNY - For memes, jokes, humorous content
â¤ï¸ LOVE - For relationship posts, love stories
ğŸ˜¢ SAD - For emotional posts, sad news
ğŸ˜  ANGRY - For controversial topics, debates
ğŸ˜® WOW - For amazing achievements, surprises
ğŸ’ª SUPPORT - For motivational posts, achievements
â“ QUESTION - For question posts, polls
ğŸ“° NEWS - For news articles, updates
ğŸ“¸ PHOTO - For photo posts, selfies
ğŸ¥ VIDEO - For video posts, reels
ğŸ“ STATUS - For status updates, thoughts
ğŸ‘‘ MARINA - Special Marina branded comments

ğŸ’« Each type has 50+ unique comments!`;
        
        await api.sendMessage(typesInfo, event.threadID);
    },

    getFBComments: async function (type, count) {
        try {
            const commentsData = await fs.readJson(commentsDatabase);
            const typeComments = commentsData[type] || this.getDefaultFBComments(type);
            
            const shuffled = [...typeComments].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(count, shuffled.length));
        } catch (error) {
            return this.getDefaultFBComments(type).slice(0, count);
        }
    },

    getDefaultFBComments: function (type) {
        const defaultComments = {
            islamic: [
                "Masha Allah! ğŸŒŸ Beautiful Islamic post.",
                "Subhanallah! May Allah bless you. ğŸ¤²",
                "JazakAllah Khair for sharing this! ğŸ’«",
                "Allahu Akbar! Wonderful reminder. ğŸ•Œ",
                "Masha Allah tabarakallah! âœ¨",
                "Beautiful Quranic verse! ğŸ“–",
                "May Allah accept our deeds. Ameen ğŸ¤²",
                "Islamic knowledge is the best knowledge! ğŸ¯",
                "Subhanallah, so meaningful! ğŸ’–",
                "Allah is the Greatest! âš¡",
                "Perfect timing for this reminder! â°",
                "Masha Allah, heart touching! â¤ï¸",
                "JazakAllah for this beneficial post! ğŸŒ¸",
                "Allah bless the one who shared this! ğŸ™",
                "Subhanallah, so true! ğŸ’¯"
            ],

            funny: [
                "Hahaha! This made my day! ğŸ˜‚",
                "LOL! Too funny! ğŸ¤£",
                "You got me laughing out loud! ğŸ˜„",
                "This is pure gold! ğŸ¤£",
                "Hahaha brilliant! ğŸ˜",
                "Can't stop laughing! ğŸ˜‚",
                "You're hilarious! ğŸ¤ª",
                "This deserves to go viral! ğŸš€",
                "Hahaha amazing sense of humor! ğŸ˜†",
                "ROFL! ğŸ¤£",
                "This is comedy gold! ğŸ­",
                "You should be a comedian! ğŸ˜„",
                "Hahaha too good! ğŸ¤£",
                "My stomach hurts from laughing! ğŸ˜‚",
                "This made me spit my drink! ğŸ’¦"
            ],

            love: [
                "So much love! â¤ï¸ Beautiful post.",
                "This is so heartwarming! ğŸ’•",
                "True love exists! ğŸ’–",
                "Relationship goals! ğŸ‘«",
                "So sweet and caring! ğŸ’˜",
                "This made me smile! ğŸ˜Š",
                "Love is beautiful! ğŸ’",
                "You two are amazing together! ğŸ’‘",
                "This is true love! ğŸ’—",
                "So romantic! ğŸ’“",
                "Love wins always! ğŸ’",
                "Beautiful love story! ğŸ’Ÿ",
                "This is so pure! â£ï¸",
                "Love conquers all! ğŸ’Œ",
                "You deserve all the love! ğŸ’–"
            ],

            sad: [
                "This is so sad ğŸ˜¢ Sending prayers.",
                "Heartbreaking ğŸ’” Stay strong!",
                "This brought tears to my eyes ğŸ˜­",
                "So emotional and touching ğŸ˜”",
                "My heart goes out to you ğŸ¤²",
                "This is really sad ğŸ˜",
                "Sending love and support ğŸ’",
                "Can feel the emotion ğŸ˜¥",
                "This is heartbreaking ğŸ˜¿",
                "Stay strong, better days ahead ğŸ’«",
                "This made me emotional ğŸ˜°",
                "Sending virtual hugs ğŸ«‚",
                "Tears in my eyes ğŸ˜“",
                "This is so moving ğŸ˜©",
                "Praying for better times ğŸŒˆ"
            ],

            angry: [
                "This is so wrong! ğŸ˜ ",
                "How can people do this? ğŸ˜¡",
                "This makes me angry! ğŸ¤¬",
                "Unacceptable behavior! ğŸ‘¿",
                "This is ridiculous! ğŸ’¢",
                "How dare they do this! ğŸ‘º",
                "This is infuriating! ğŸ˜¤",
                "Completely unacceptable! ğŸ¤¯",
                "This is terrible! ğŸ˜¾",
                "So frustrating to see this! ğŸ’€",
                "This needs to stop! ğŸ›‘",
                "How can this happen? ğŸ˜ ",
                "This is outrageous! ğŸ˜¡",
                "Someone should do something! âš–ï¸",
                "This is not right! âŒ"
            ],

            wow: [
                "Wow! This is amazing! ğŸ˜®",
                "Incredible achievement! ğŸ¤©",
                "Absolutely fantastic! ğŸ‰",
                "Brilliant work! âœ¨",
                "Outstanding! ğŸŒŸ",
                "Magnificent! ğŸ‘‘",
                "Spectacular! ğŸ’«",
                "Phenomenal! ğŸ”¥",
                "Extraordinary! ğŸš€",
                "Mind-blowing! ğŸ¤¯",
                "Absolutely stunning! ğŸ’",
                "This is epic! ğŸ†",
                "Beyond amazing! ğŸŒˆ",
                "Simply wonderful! ğŸ‘",
                "This is next level! â­"
            ],

            support: [
                "You can do it! ğŸ’ª Keep going!",
                "I believe in you! ğŸŒŸ",
                "You're amazing! âœ¨",
                "Stay strong! ğŸ’–",
                "We support you! ğŸ‘",
                "You got this! ğŸ”¥",
                "Proud of you! ğŸ¯",
                "Keep shining! â˜€ï¸",
                "You're doing great! ğŸ‘",
                "Don't give up! ğŸš€",
                "You're stronger than you think! ğŸ’",
                "Keep moving forward! ğŸ”„",
                "You're capable of anything! ğŸŒˆ",
                "Stay positive! ğŸ˜Š",
                "You're a warrior! âš”ï¸"
            ],

            photo: [
                "Great photo! ğŸ“¸ Looking amazing!",
                "Wonderful picture! ğŸ–¼ï¸",
                "Photo perfect! ğŸ‘",
                "Beautiful capture! ğŸŒŸ",
                "Awesome shot! ğŸ¯",
                "Picture perfect moment! ğŸ“·",
                "Lovely photo! ğŸ’",
                "Amazing picture quality! ğŸ”¥",
                "Stunning photo! âœ¨",
                "Perfect click! âœ…",
                "Beautiful memories! ğŸ’«",
                "Great photography! ğŸ‘Œ",
                "Lovely capture! ğŸ¨",
                "Photo of the day! ğŸ†",
                "Fantastic picture! ğŸš€"
            ],

            video: [
                "Great video! ğŸ¥ Loved it!",
                "Awesome video content! ğŸ”¥",
                "Video is amazing! âœ¨",
                "Well made video! ğŸ‘",
                "Enjoyed watching! ğŸ¬",
                "Fantastic video! ğŸš€",
                "Video is fire! ğŸ”¥",
                "Loved the video! â¤ï¸",
                "Great content! ğŸ“¹",
                "Video is perfect! âœ…",
                "Amazing video quality! ğŸ’",
                "Well edited video! ğŸ­",
                "Video is brilliant! ğŸŒŸ",
                "Loved every second! â±ï¸",
                "Perfect video! ğŸ†"
            ],

            marina: [
                "Marina approves this post! ğŸ‘‘",
                "From Marina with love! ğŸ’",
                "Marina's seal of approval! âœ…",
                "Powered by Marina's wisdom! ğŸ’»",
                "Marina says this is great! ğŸŒŸ",
                "Marina's favorite type of post! ğŸ¯",
                "Marina would love this! ğŸ’«",
                "Marina's comment: Awesome! ğŸ”¥",
                "Marina's tech insight: Perfect! ğŸ’",
                "Marina sends love for this post! â¤ï¸",
                "Marina's developer perspective: Great! ğŸš€",
                "Marina finds this post amazing! âœ¨",
                "Marina's expert opinion: Wonderful! ğŸ‘",
                "Marina's special comment: Brilliant! ğŸŒˆ",
                "Marina's final verdict: Excellent! ğŸ†"
            ]
        };

        return defaultComments[type] || ["Great post! ğŸ‘"];
    },

    ensureDataDir: async function () {
        const dataDir = path.join(__dirname, '..', 'data');
        await fs.ensureDir(dataDir);
        if (!fs.existsSync(commentsDatabase)) {
            await fs.writeJson(commentsDatabase, {});
        }
    }
};
