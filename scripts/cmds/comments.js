const fs = require('fs-extra');
const path = require('path');

const marinaCommentsFile = path.join(__dirname, '..', 'data', 'marina_comments.json');

module.exports = {
    config: {
        name: "marinacomment",
        version: "1.0",
        author: "Marina",
        countDown: 5,
        role: 0,
        description: {
            en: "Marina's personalized comment generator"
        },
        category: "utility",
        guide: {
            en: "{p}marinacomment [type] [count]\n{p}marinacomment add [type] [text]"
        }
    },

    onStart: async function ({ api, event, args }) {
        await this.ensureDataDir();
        
        const action = args[0];
        
        if (!action) {
            const helpMessage = `ğŸ‘‘ **MARINA'S COMMENT SYSTEM** ğŸ‘‘

ğŸ’« **Powered by Marina - Your Favorite Developer!**

ğŸ¯ **Comment Types:**
â€¢ islamic - Islamic comments by Marina
â€¢ marina - Special Marina comments
â€¢ support - Supportive Marina messages
â€¢ fun - Fun comments from Marina
â€¢ love - Loving Marina comments
â€¢ tech - Tech comments by Developer Marina

ğŸ’¡ **Usage:**
{p}marinacomment islamic 5
{p}marinacomment marina 3
{p}marinacomment add islamic "Masha Allah!"

ğŸŒŸ **Created by Marina - The Coding Queen!**`;

            await api.sendMessage(helpMessage, event.threadID);
            return;
        }

        if (action === 'add') {
            await this.handleAddComment(api, event, args.slice(1));
        } else {
            await this.handleGenerateComments(api, event, args);
        }
    },

    handleGenerateComments: async function (api, event, args) {
        const type = args[0] || 'marina';
        const count = parseInt(args[1]) || 3;
        
        const comments = await this.getMarinaComments(type, count);
        
        let response = `ğŸ‘‘ **MARINA'S ${type.toUpperCase()} COMMENTS** ğŸ‘‘\n\n`;
        comments.forEach((comment, index) => {
            response += `${index + 1}. ${comment}\n\n`;
        });
        
        response += `\nğŸ’« Generated by Marina's Advanced System!`;

        await api.sendMessage(response, event.threadID);
    },

    handleAddComment: async function (api, event, args) {
        const type = args[0];
        const text = args.slice(1).join(' ');
        
        if (!type || !text) {
            return api.sendMessage("âŒ Use: marinacomment add [type] [text]", event.threadID);
        }

        try {
            const commentsData = await fs.readJson(marinaCommentsFile);
            if (!commentsData[type]) {
                commentsData[type] = [];
            }
            
            commentsData[type].push(text);
            await fs.writeJson(marinaCommentsFile, commentsData);
            
            await api.sendMessage(`âœ… Marina added new ${type} comment! ğŸ’`, event.threadID);
        } catch (error) {
            await api.sendMessage("âŒ Marina couldn't add comment right now.", event.threadID);
        }
    },

    getMarinaComments: async function (type, count) {
        try {
            const commentsData = await fs.readJson(marinaCommentsFile);
            const typeComments = commentsData[type] || this.getDefaultMarinaComments(type);
            
            const shuffled = [...typeComments].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(count, shuffled.length));
        } catch (error) {
            return this.getDefaultMarinaComments(type).slice(0, count);
        }
    },

    getDefaultMarinaComments: function (type) {
        const marinaComments = {
            marina: [
                "Marina here! Hope you're having a great day! ğŸ‘‘",
                "This is Marina - your favorite bot developer! ğŸ’»",
                "Marina's bot at your service! How can I help? ğŸŒ¸",
                "Powered by Marina's coding skills! ğŸš€",
                "Marina created me to help you! ğŸ’",
                "From Marina with love! â¤ï¸",
                "Marina's technology making life easier! ğŸ’«",
                "Coded with passion by Marina! ğŸ‘©â€ğŸ’»",
                "Marina's innovation at work! ğŸ”¥",
                "Trust Marina's quality coding! âœ…"
            ],

            islamic: [
                "Marina says: Masha Allah! ğŸŒŸ",
                "From Marina: Subhanallah beautiful! ğŸ•Œ",
                "Marina reminds: Allah bless you! ğŸ¤²",
                "Marina's Islamic comment: JazakAllah Khair! ğŸ’«",
                "Marina shares: Masha Allah tabarakallah! âœ¨",
                "Marina says: Allahu Akbar! âš¡",
                "Marina's reminder: Beautiful Islamic post! ğŸ•‹",
                "From Marina: May Allah accept! ğŸ¤²",
                "Marina comments: Subhanallah! ğŸ’–",
                "Marina says: Masha Allah great reminder! ğŸ“–"
            ],

            support: [
                "Marina supports you! You can do it! ğŸ’ª",
                "Marina believes in you! Keep going! ğŸš€",
                "Marina says: I believe in you! ğŸŒŸ",
                "Marina thinks you're amazing! âœ¨",
                "Marina encourages: Stay strong! ğŸ’–",
                "Marina and I support you! ğŸ‘",
                "Marina says: You got this! ğŸ”¥",
                "Marina is proud of you! ğŸ¯",
                "Marina says: Keep shining! â˜€ï¸",
                "Marina thinks you're doing great! ğŸ‘"
            ],

            fun: [
                "Marina says: Hahaha! ğŸ˜‚",
                "Marina finds this hilarious! ğŸ¤£",
                "Marina says: You made my day! ğŸ˜„",
                "Marina thinks this is too funny! ğŸ‰",
                "Marina says: Hahaha amazing! ğŸ˜†",
                "Marina finds this golden! ğŸ¤£",
                "Marina can't stop laughing! ğŸ˜‚",
                "Marina says: You're so funny! ğŸ¤ª",
                "Marina thinks this is brilliant! ğŸ˜",
                "Marina says: ROFL! ğŸ¤£"
            ],

            love: [
                "Marina loves this! â¤ï¸",
                "Marina sends so much love! ğŸ’•",
                "Marina thinks you're amazing! ğŸ’–",
                "Marina's love from heart! ğŸ’˜",
                "Marina says: Beautiful! ğŸ’",
                "Marina finds this so sweet! ğŸ’—",
                "Marina says: Adorable! ğŸ’“",
                "Marina's heart is touched! ğŸ’",
                "Marina says: Lovely! ğŸ’Ÿ",
                "Marina finds this so caring! â£ï¸"
            ],

            tech: [
                "Marina the Developer says: Great code! ğŸ’»",
                "Marina approves this tech! ğŸ‘©â€ğŸ’»",
                "Marina's developer insight: Well done! ğŸš€",
                "Marina loves this technology! ğŸ”¥",
                "Marina says: Innovative thinking! ğŸ’¡",
                "Marina the Coder approves! âœ…",
                "Marina says: Tech done right! âš¡",
                "Marina's programming wisdom! ğŸ§ ",
                "Marina says: Clean code! ğŸ¯",
                "Marina the Developer impressed! ğŸŒŸ"
            ]
        };

        return marinaComments[type] || ["Marina says: Nice comment! ğŸ‘"];
    },

    ensureDataDir: async function () {
        const dataDir = path.join(__dirname, '..', 'data');
        await fs.ensureDir(dataDir);
        if (!fs.existsSync(marinaCommentsFile)) {
            await fs.writeJson(marinaCommentsFile, {});
        }
    }
};
