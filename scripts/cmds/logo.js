const axios = require('axios');
const fs = require('fs-extra');
const path = require('path');

module.exports = {
    config: {
        name: "logo",
        version: "2.0.0",
        role: 0,
        author: "Marina Khan",
        category: "design",
        description: "Create beautiful logos with your name",
        guide: "{pn} [your name]"
    },

    onStart: async function({ api, event, args }) {
        try {
            const name = args.join(' ');
            
            if (!name) {
                return api.sendMessage(`ğŸ¨ **Logo Designer**\n\nUsage: !logo [Your Name]\nExample: !logo Marina Khan\n\nâœ¨ Create stunning logos instantly!`, event.threadID);
            }

            api.sendMessage(`ğŸ”„ Creating logo for "${name}"...`, event.threadID);

            // Use reliable logo APIs
            const logoUrls = [
                `https://api.botcahx.live/api/photooxy/blackpink?text=${encodeURIComponent(name)}&apikey=Admin`,
                `https://api.botcahx.live/api/photooxy/shadow-text?text=${encodeURIComponent(name)}&apikey=Admin`,
                `https://api.botcahx.live/api/photooxy/carved-wood?text=${encodeURIComponent(name)}&apikey=Admin`,
                `https://api.zahwazein.xyz/photooxy/romantic?text=${encodeURIComponent(name)}&apikey=zenzkey_669bcbf0fb`
            ];

            let success = false;
            
            for (let logoUrl of logoUrls) {
                try {
                    const response = await axios.get(logoUrl, { 
                        responseType: 'stream',
                        timeout: 30000 
                    });
                    
                    if (response.status === 200) {
                        await api.sendMessage({
                            body: `âœ¨ **Logo Created Successfully!**\n\nğŸ“ Name: ${name}\nğŸ¨ Style: Professional\nğŸŒˆ Generated by Marina AI\n\nğŸ’ Perfect for your brand!`,
                            attachment: response.data
                        }, event.threadID);
                        success = true;
                        break;
                    }
                } catch (apiError) {
                    console.log(`API failed: ${logoUrl}`);
                    continue;
                }
            }

            if (!success) {
                // Fallback to simple text logo
                await createTextLogo(api, event, name);
            }

        } catch (error) {
            console.error("Logo error:", error);
            await createTextLogo(api, event, args.join(' ') || "Your Name");
        }
    }
};

// Fallback text logo
async function createTextLogo(api, event, name) {
    const textLogo = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          â•‘
â•‘        ğŸ¨ LOGO STUDIO    â•‘
â•‘                          â•‘
â•‘         ${name}         â•‘
â•‘                          â•‘
â•‘    Designed by Marina AI â•‘
â•‘                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    `;
    
    api.sendMessage(`âœ¨ **Text Logo Created**\n\n${textLogo}\n\nğŸ’¡ Tip: The image logo service is temporarily unavailable.`, event.threadID);
}
